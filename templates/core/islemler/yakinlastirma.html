{% extends 'core/islemler/islem_base.html' %}
{% load static %}

{% block title %}Görüntü Yakınlaştırma - Görüntü İşleme{% endblock %}

{% block islem_title %}Görüntü Yakınlaştırma{% endblock %}

{% block islem_parametreleri %}
<div class="mb-3">
    <label class="form-label">Ölçek Faktörü</label>
    <div class="d-flex align-items-center gap-3">
        <input type="range" class="form-range flex-grow-1" id="olcekFaktoru" min="0.1" max="5" value="1" step="0.1">
        <span id="olcekDegeriText" class="badge bg-primary">1.0x</span>
    </div>
</div>

<div class="mb-3">
    <label class="form-label">İnterpolasyon Yöntemi</label>
    <select class="form-select" id="interpolasyonYontemi">
        <option value="nearest">En Yakın Komşu</option>
        <option value="linear">Bilineer</option>
        <option value="cubic">Bikübik</option>
        <option value="lanczos">Lanczos</option>
    </select>
</div>

<div class="mb-3">
    <div class="form-check">
        <input class="form-check-input" type="checkbox" id="antiAliasing" checked>
        <label class="form-check-label" for="antiAliasing">
            Anti-aliasing Uygula
        </label>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}

<script>
// Ölçek değeri değiştiğinde göstergeyi güncelle
document.getElementById('olcekFaktoru').addEventListener('input', function() {
    document.getElementById('olcekDegeriText').textContent = this.value + 'x';
});

// İşlem butonuna tıklandığında
processButton.addEventListener('click', async function() {
    if (!imageInput.files[0]) {
        alert('Lütfen bir görüntü seçin');
        return;
    }

    // İşlem başladığında butonu devre dışı bırak
    this.disabled = true;
    this.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>İşlem Yapılıyor...';

    try {
        // Form verilerini hazırla
        const formData = new FormData();
        formData.append('image', imageInput.files[0]);
        formData.append('olcek_faktoru', document.getElementById('olcekFaktoru').value);
        formData.append('interpolasyon', document.getElementById('interpolasyonYontemi').value);
        formData.append('antiAliasing', document.getElementById('antiAliasing').checked);
        
        // CSRF token al
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        
        // İşlemi başlat
        const response = await fetch('/yakinlastirma/isle/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrftoken
            },
            body: formData
        });

        if (!response.ok) {
            const errorData = await response.text();
            throw new Error(errorData || 'İşlem sırasında bir hata oluştu');
        }

        const responseData = await response.json();

        if (!responseData.success) {
            throw new Error(responseData.error || 'İşlem başarısız oldu');
        }

        // İşlenmiş görüntüyü göster
        processedImage.src = responseData.image;
        processedImage.style.display = 'block';
        processedPlaceholder.style.display = 'none';

        // İşlem başarılı olduğunda butonu tekrar aktif et
        processButton.disabled = false;
        processButton.innerHTML = '<i class="bi bi-play-circle me-2"></i>İşlemi Başlat';

    } catch (error) {
        console.error('Hata:', error);
        alert('Hata: ' + error.message);
        // Hata durumunda butonu tekrar aktif et
        this.disabled = false;
        this.innerHTML = '<i class="bi bi-play-circle me-2"></i>İşlemi Başlat';
    }
});
</script>
{% endblock %} 